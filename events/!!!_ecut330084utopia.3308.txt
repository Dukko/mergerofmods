namespace = utopia
country_event = {
    id = utopia.3308
    title = "utopia.3000.name"
    desc = "utopia.3308.desc"
    diplomatic = yes
    diplomatic_title = BLANK_STRING
    force_open = yes
    picture_event_data = {
        portrait = shroud1
        room = shroud_room
    }
    is_triggered_only = yes
    immediate = {
        set_country_flag = shroud_diplomacy_engaged
    }
    after = {
        hidden_effect = {
            remove_country_flag = shroud_diplomacy_engaged
        }
    }
    option = {
        name = "utopia.3308.a"
        custom_tooltip = "covenant.cycle.tooltip"
        add_modifier = {
            modifier = covenant_end_of_the_cycle
            days = 18000
        }
        add_research_option = tech_colossus
        add_research_option = tech_pk_shielder
        hidden_effect = {
            set_global_flag = end_of_the_cycle
            set_country_flag = has_shroud_patron
            set_country_flag = covenant_end_of_the_cycle
            every_owned_planet = {
                limit = {
                    NOT = {
                        has_modifier = covenant_shroud_marked
                    }
                }
                add_modifier = {
                    modifier = covenant_shroud_marked
                    days = -1
                }
            }
            every_subject = {
                every_owned_planet = {
                    limit = {
                        NOT = {
                            has_modifier = covenant_shroud_marked
                        }
                    }
                    add_modifier = {
                        modifier = covenant_shroud_marked
                        days = -1
                    }
                }
            }
            country_event = {
                id = utopia.3310
            }
            country_event = {
                id = utopia.3320
                days = 18000
            }
        }
    }
    option = {
        name = "exit.shroud"
        custom_tooltip = "exit.shroud.tooltip"
        default_hide_option = yes
    }
}
