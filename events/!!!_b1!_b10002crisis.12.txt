namespace = crisis
country_event = {
    id = crisis.12
    hide_window = yes
    fire_only_once = yes
    mean_time_to_happen = {
        months = 600
    }
    trigger = {
        is_country_type = default
        has_global_flag = prethoryn_subspace_echoes
    }
    immediate = {
        remove_global_flag = prethoryn_subspace_echoes
        set_global_flag = prethoryn_approaching_rim
        random_rim_system = {
            limit = {
                OR = {
                    NOR = {
                        is_star_class = sc_dn
                        any_neighbor_system = {
                            exists = space_owner
                        }
                        exists = space_owner
                    }
                    AND = {
                        exists = space_owner
                        space_owner = {
                            NOR = {
                                is_country_type = fallen_empire
                                is_country_type = awakened_fallen_empire
                            }
                        }
                    }
                }
                NOT = {
                    any_neighbor_system = {
                        exists = space_owner
                        space_owner = {
                            OR = {
                                is_country_type = fallen_empire
                                is_country_type = awakened_fallen_empire
                            }
                        }
                    }
                }
            }
            set_star_flag = swarm_invasion_target_1
            save_event_target_as = prethoryn_invasion_system
            closest_system = {
                limit = {
                    NOR = {
                        has_star_flag = swarm_invasion_warning
                        has_star_flag = swarm_invasion_target_1
                    }
                }
                set_star_flag = swarm_invasion_warning
                save_event_target_as = swarm_invasion_warning_1
            }
            closest_system = {
                limit = {
                    NOR = {
                        has_star_flag = swarm_invasion_warning
                        has_star_flag = swarm_invasion_target_1
                    }
                }
                set_star_flag = swarm_invasion_warning
                save_event_target_as = swarm_invasion_warning_2
            }
            closest_system = {
                limit = {
                    NOR = {
                        has_star_flag = swarm_invasion_warning
                        has_star_flag = swarm_invasion_target_1
                    }
                }
                set_star_flag = swarm_invasion_warning
                save_event_target_as = swarm_invasion_warning_3
            }
            closest_system = {
                limit = {
                    NOR = {
                        has_star_flag = swarm_invasion_warning
                        has_star_flag = swarm_invasion_target_1
                    }
                }
                set_star_flag = swarm_invasion_warning
                save_event_target_as = swarm_invasion_warning_4
            }
            closest_system = {
                limit = {
                    NOR = {
                        has_star_flag = swarm_invasion_warning
                        has_star_flag = swarm_invasion_target_1
                    }
                }
                set_star_flag = swarm_invasion_warning
                save_event_target_as = swarm_invasion_warning_5
            }
        }
        observer_event = {
            id = observer.28
        }
        every_country = {
            limit = {
                is_country_type = default
            }
            country_event = {
                id = crisis.13
            }
        }
    }
}
