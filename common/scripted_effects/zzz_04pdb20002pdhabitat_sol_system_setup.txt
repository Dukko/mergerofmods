pdhabitat_sol_system_setup = {
    owner = {
        save_event_target_as = pdhabitat_sol_system_owner
    }
    solar_system = {
        random_system_planet = {
            limit = {
                OR = {
                    has_planet_flag = pd_habitat_start_earth
                    has_planet_flag = pd_habitat_start
                }
            }
            remove_building = building_research_lab_1
            add_building = building_foundry_1
            add_modifier = {
                modifier = pd_moon_start_homeworld
                days = 7200
            }
            add_district = district_industrial
            add_district = district_farming
        }
        random_system_planet = {
            limit = {
                has_planet_flag = pd_habitat_start_luna
            }
            set_owner = event_target:pdhabitat_sol_system_owner
            while = {
                count = 2
                create_pop = {
                    species = owner_main_species
                }
            }
            set_planet_flag = pd_commercial_hab
            set_planet_flag = pd_hab_d1
            add_district = district_pdhab_commercial
            add_modifier = {
                modifier = pd_moon_start_moon
                days = 7200
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_ammonia_preference
                    }
                }
                add_modifier = {
                    modifier = pdammoniaatmosphere
                    days = -1
                }
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_ash_preference
                    }
                }
                add_modifier = {
                    modifier = pdashatmosphere
                    days = -1
                }
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_methane_preference
                    }
                }
                add_modifier = {
                    modifier = pdmethaneatmosphere
                    days = -1
                }
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_sulfur_preference
                    }
                }
                add_modifier = {
                    modifier = pdsulfuratmosphere
                    days = -1
                }
            }
        }
        random_system_planet = {
            limit = {
                has_planet_flag = pd_habitat_start_mars
            }
            set_owner = event_target:pdhabitat_sol_system_owner
            while = {
                count = 3
                create_pop = {
                    species = owner_main_species
                }
            }
            set_planet_flag = pd_science_hab
            set_planet_flag = pd_hab_d1
            add_district = district_pdhab_science
            add_modifier = {
                modifier = pd_moon_start_colony
                days = 7200
            }
            if = {
                limit = {
                    has_planet_flag = pdmars
                }
                set_planet_entity = {
                    entity = "bhab_planet_mars_entity"
                    picture = pc_pd_mars_hab
                }
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_ammonia_preference
                    }
                }
                add_modifier = {
                    modifier = pdammoniaatmosphere
                    days = -1
                }
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_ash_preference
                    }
                }
                add_modifier = {
                    modifier = pdashatmosphere
                    days = -1
                }
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_methane_preference
                    }
                }
                add_modifier = {
                    modifier = pdmethaneatmosphere
                    days = -1
                }
            }
            IF = {
                limit = {
                    owner = {
                        has_trait = trait_pc_sulfur_preference
                    }
                }
                add_modifier = {
                    modifier = pdsulfuratmosphere
                    days = -1
                }
            }
        }
    }
}
