namespace = utopia
country_event = {
    id = utopia.1
    title = "utopia.1.name"
    desc = {
        trigger = {
            switch = {
                trigger = has_ethic
                ethic_fanatic_xenophobe = {
                    text = utopia.1.desc.v1
                }
                ethic_fanatic_xenophile = {
                    text = utopia.1.desc.v2
                }
                ethic_fanatic_materialist = {
                    text = utopia.1.desc.v2
                }
                ethic_fanatic_spiritualist = {
                    text = utopia.1.desc.v4
                }
                ethic_fanatic_authoritarian = {
                    text = utopia.1.desc.v1
                }
                ethic_fanatic_egalitarian = {
                    text = utopia.1.desc.v2
                }
                ethic_fanatic_militarist = {
                    text = utopia.1.desc.v1
                }
                ethic_fanatic_pacifist = {
                    text = utopia.1.desc.v2
                }
            }
        }
    }
    picture = GFX_evt_ringworld
    show_sound = event_conversation
    location = event_target:ring_world.capital_scope
    trigger = {
        is_country_type = default
        AND = {
            any_neighbor_country = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = ring_world_1
                        is_megastructure_type = ring_world_2
                    }
                    is_upgrading = yes
                }
                is_country_type = default
                has_communications = root
                NOR = {
                    has_country_flag = ringworld_diplomatic_event
                    is_at_war_with = ROOT
                    is_subject_type = vassal
                    is_same_value = root
                }
            }
            OR = {
                has_ethic = ethic_fanatic_xenophobe
                has_ethic = ethic_fanatic_xenophile
                has_ethic = ethic_fanatic_materialist
                has_ethic = ethic_fanatic_spiritualist
                has_ethic = ethic_fanatic_authoritarian
                has_ethic = ethic_fanatic_egalitarian
                has_ethic = ethic_fanatic_militarist
                has_ethic = ethic_fanatic_pacifist
            }
            NOR = {
                has_country_flag = ringworld_diplomatic_event
                has_valid_civic = civic_fanatic_purifiers
            }
        }
    }
    mean_time_to_happen = {
        days = 3600
    }
    immediate = {
        random_neighbor_country = {
            limit = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = ring_world_1
                        is_megastructure_type = ring_world_2
                    }
                    is_upgrading = yes
                }
                NOR = {
                    has_country_flag = ringworld_diplomatic_event
                    is_at_war_with = ROOT
                    is_subject_type = vassal
                    is_same_value = root
                }
                is_country_type = default
                has_communications = root
            }
            random_owned_megastructure = {
                limit = {
                    OR = {
                        is_megastructure_type = ring_world_1
                        is_megastructure_type = ring_world_2
                    }
                    is_upgrading = yes
                }
                save_event_target_as = ring_world
            }
            save_event_target_as = ringworld_builder
            event_target:ringworld_builder = {
                set_country_flag = ringworld_diplomatic_event
            }
        }
        set_country_flag = ringworld_diplomatic_event
        switch = {
            trigger = has_ethic
            ethic_fanatic_xenophobe = {
                set_country_flag = ethic_xenophobe
            }
            ethic_fanatic_xenophile = {
                set_country_flag = ethic_xenophile
            }
            ethic_fanatic_materialist = {
                set_country_flag = ethic_materialist
            }
            ethic_fanatic_spiritualist = {
                set_country_flag = ethic_spiritualist
            }
            ethic_fanatic_authoritarian = {
                set_country_flag = ethic_authoritarian
            }
            ethic_fanatic_egalitarian = {
                set_country_flag = ethic_egalitarian
            }
            ethic_fanatic_militarist = {
                set_country_flag = ethic_militarist
            }
            ethic_fanatic_pacifist = {
                set_country_flag = ethic_pacifist
            }
        }
    }
    option = {
        name = utopia.1.a
        ai_chance = {
            factor = 90
        }
        event_target:ringworld_builder = {
            country_event = {
                id = utopia.2
                days = 5
            }
        }
    }
    option = {
        name = utopia.1.b
        custom_tooltip = ariphaos_patch_utopia.1.b.tooltip
        ai_chance = {
            factor = 10
        }
        switch = {
            trigger = has_country_flag
            ethic_xenophobe = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_xenophobe
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
            ethic_xenophile = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_xenophile
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
            ethic_materialist = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_materialist
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
            ethic_spiritualist = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_spiritualist
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
            ethic_authoritarian = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_authoritarian
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
            ethic_egalitarian = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_egalitarian
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
            ethic_militarist = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_militarist
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
            ethic_pacifist = {
                hidden_effect = {
                    every_owned_pop = {
                        limit = {
                            has_ethic = ethic_pacifist
                            NOT = {
                                has_modifier = megastructure_demands_rejected
                            }
                        }
                        add_modifier = {
                            modifier = megastructure_demands_rejected
                            days = 7200
                        }
                    }
                }
            }
        }
    }
}