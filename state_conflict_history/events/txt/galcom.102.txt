namespace = galcom
fleet_event = {
    id = galcom.102
    hide_window = yes
    is_triggered_only = yes
    trigger = {
        is_galactic_community_formed = yes
        owner = {
            is_tiyanki_country_type = yes
        }
        is_active_resolution = "resolution_tiyanki_pest_control"
    }
    immediate = {
        from = {
            save_event_target_as = tiyanki_system
        }
        if = {
            limit = {
                exists = from.owner
                from = {
                    owner = {
                        is_galactic_community_member = yes
                        NOT = {
                            has_country_flag = resolution_breached_tiyanki_inside_borders
                        }
                    }
                }
            }
            from = {
                owner = {
                    set_country_flag = resolution_breached_tiyanki_inside_borders
                    country_event = {
                        id = galcom.106
                    }
                }
            }
        }
        if = {
            limit = {
                any_playable_country = {
                    is_galactic_community_member = yes
                    has_country_flag = resolution_breached_tiyanki_inside_borders
                    NOT = {
                        any_system_within_border = {
                            any_fleet_in_system = {
                                owner = {
                                    is_tiyanki_country_type = yes
                                }
                            }
                        }
                    }
                }
            }
            every_playable_country = {
                limit = {
                    is_galactic_community_member = yes
                    has_country_flag = resolution_breached_tiyanki_inside_borders
                    NOT = {
                        any_system_within_border = {
                            any_fleet_in_system = {
                                owner = {
                                    is_tiyanki_country_type = yes
                                }
                            }
                        }
                    }
                }
                remove_country_flag = resolution_breached_tiyanki_inside_borders
            }
        }
    }
}